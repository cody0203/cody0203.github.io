<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Shopping Cart</title>

    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <div id="root"></div>

    <script src="https://unpkg.com/react/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel" src="./js/header.js"></script>
    <script type="text/babel" src="./js/products.js"></script>
    <script type="text/babel" src="./js/checkout.js"></script>

    <script type="text/babel">
      function convertPrice(price) {
        return new Intl.NumberFormat("vi-VN", {
          style: "currency",
          currency: "VND"
        }).format(price);
      }

      class ShoppingCart extends React.Component {
        constructor(props) {
          super(props);
          this.state = {
            products: [
              {
                name: "PRODUCT ITEM NUMBER 1",
                image: "https://via.placeholder.com/200x150",
                description: "Description for product item number 1",
                price: 100000,
                quantity: 10,
                id: 1
              },
              {
                name: "PRODUCT ITEM NUMBER 2",
                image: "https://via.placeholder.com/200x150",
                description: "Description for product item number 2",
                price: 250000,
                quantity: 3,
                id: 2
              },
              {
                name: "PRODUCT ITEM NUMBER 3",
                image: "https://via.placeholder.com/200x150",
                description: "Description for product item number 3",
                price: 3000000,
                quantity: 4,
                id: 3
              }
            ],
            promoCode: "",
            input: "",
            promoCodeList: {
              Autumn: 200000,
              Winter: 500000,
              Spring: 150000,
              Summer: 300000
            }
          };
          this.handleQuantity = this.handleQuantity.bind(this);
          this.removeProduct = this.removeProduct.bind(this);
          this.isPromoCodeValid = this.isPromoCodeValid.bind(this);
          this.handleChange = this.handleChange.bind(this);
        }

        handleQuantity = e => {
          let { value, min, max } = event.target;
          let id = event.target.getAttribute("data-key");
          if (value < 0) event.target.value = 0;
          if (value > 20) event.target.value = 20;
          value = Math.max(Number(min), Math.min(Number(max), Number(value)));

          let products = this.state.products.map(product => {
            if (product.id == id) {
              product.quantity = Number(value);
            }
            return product;
          });
          this.setState({
            products: products
          });
        };

        removeProduct = e => {
          let id = event.target.getAttribute("data-key");
          let products;
          if (confirm("Are you sure")) {
            products = this.state.products.filter(product => {
              return product.id !== Number(id);
            });
            this.setState({
              products: products
            });
          }
        };

        componentDidMount() {
          this.setState({
            promoCode: undefined
          });
        }

        handleChange(e) {
          this.setState({
            input: event.target.value
          });
        }

        isPromoCodeValid() {
          this.setState({
            promoCode: this.state.input
          });
        }

        render() {
          return (
            <main>
              <ShoppingCartHeader products={this.state.products} />
              <Products
                products={this.state.products}
                totalProductsInBag={this.state.totalProductsInBag}
                handleQuantity={this.handleQuantity}
                removeProduct={this.removeProduct}
              />
              <Checkout
                products={this.state.products}
                promoCode={this.state.promoCode}
                promoCodeList={this.state.promoCodeList}
                handleChange={this.handleChange}
                isPromoCodeValid={this.isPromoCodeValid}
              />
            </main>
          );
        }
      }
      ReactDOM.render(<ShoppingCart />, document.getElementById("root"));
    </script>
  </body>
</html>
